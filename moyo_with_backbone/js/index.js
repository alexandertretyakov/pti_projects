var _products = [
    {
        title: 'Ноутбук ASUS Zenbook 14 UX435EG-K9348R (90NB0SI1-M009L0)',
        manufacturer: 'ASUS',
        discount: false,
        markers: {
            hit: true,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: true,
        price: 24966,
        reviews: 6,
        producingCountry: 'China',
        color: 'grey',
        warranty: 12,
        diagonal: 16,
        processorManufacturer: 'AMD',
        RAMCapacity: 4,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'NVIDIA GeForce RTX 3050Ti',
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: false,
        weight: 1.2,
        id: '499505'
    },
    {
        title: 'Ноутбук ASUS Vivobook Pro M7600QC-L2002W 16.0WQUXGA OLED (90NB0V81-M02180)',
        manufacturer: 'ASUS',
        discount: 6,
        markers: {
            hit: false,
            bestPrice: true,
            exclusive: false
        },
        rating: 2,
        available: true,
        price: 21966,
        reviews: 3,
        producingCountry: 'China',
        color: 'silver',
        warranty: 24,
        diagonal: 13.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 4,
        videoCardIntegrated: 'Intel Iris Xe Graphics',
        videoCardDiscrete: 'Nvidia GeForce RTX 3070',
        SSDVolume: 512,
        preinstalledOS: 'DOS',
        keyboardBacklit: true,
        weight: 1.7,
        id: '499506'
    },
    {
        title: 'Ноутбук LENOVO IdeaPad 3i 15ITL6 (82H800U3RA)',
        manufacturer: 'LENOVO',
        discount: 10,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: true
        },
        rating: 2,
        available: false,
        price: 12712,
        reviews: 1,
        producingCountry: 'China',
        color: 'grey',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 256,
        preinstalledOS: 'Linux',
        keyboardBacklit: true,
        weight: 1.6,
        id: '499507'
    },
    {
        title: 'Ноутбук LENOVO IdeaPad 3 15IGL05 (81WQ001CRA)',
        manufacturer: 'LENOVO',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: true,
        price: 15966,
        reviews: null,
        producingCountry: 'China',
        color: 'silver',
        warranty: 36,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 128,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 2.7,
        id: '499508'
    },
    {
        title: 'Ноутбук ASUS Vivobook 14 K413EQ-EB347 (90NB0RKF-M05600)',
        manufacturer: 'ASUS',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 4,
        available: true,
        price: 74299,
        reviews: 5,
        producingCountry: 'China',
        color: 'silver',
        warranty: 12,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel Iris Xe Graphics',
        videoCardDiscrete: 'NVIDIA GeForce RTX 3080',
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: false,
        weight: 1.7,
        id: '499509'
    },
    {
        title: 'Ноутбук ASUS X415EP-EB229 (90NB0TU2-M02610)',
        manufacturer: 'ASUS',
        discount: 14,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: true,
        price: 99999,
        reviews: 1,
        producingCountry: 'China',
        color: 'silver',
        warranty: 12,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: 'Linux',
        keyboardBacklit: true,
        weight: 1.5,
        id: '499510'
    },
    {
        title: 'Ноутбук ASUS X415EP-EB230 (90NB0TU1-M02620)',
        manufacturer: 'ASUS',
        discount: 20,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: false,
        price: 89999,
        reviews: 22,
        producingCountry: 'China',
        color: 'grey',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 4,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: false,
        SSDVolume: 256,
        preinstalledOS: 'DOS',
        keyboardBacklit: true,
        weight: 2.1,
        id: '499511'
    },
    {
        title: 'Ноутбук LENOVO IdeaPad 3 15IGL05 (81WQ001DRA)',
        manufacturer: 'LENOVO',
        discount: 4,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: false,
        price: 19712,
        reviews: null,
        producingCountry: 'China',
        color: 'grey',
        warranty: 24,
        diagonal: 16,
        processorManufacturer: 'AMD',
        RAMCapacity: 4,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'AMD Radeon RX 640',
        SSDVolume: 256,
        preinstalledOS: 'Windows 11 Pro',
        keyboardBacklit: false,
        weight: 2.1,
        id: '499512'
    },
    {
        title: 'Ноутбук HP 15s-eq2064ua (5B7U4EA)',
        manufacturer: 'HP',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: true,
        price: 54100,
        reviews: null,
        producingCountry: 'China',
        color: 'silver',
        warranty: 36,
        diagonal: 15.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 8,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: false,
        SSDVolume: 256,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 2.5,
        id: '499513'
    },
    {
        title: 'Ноутбук ACER Aspire 3 A315-34 (NX.HE3EU.05C)',
        manufacturer: 'ACER',
        discount: 14,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 3,
        available: true,
        price: 34400,
        reviews: 15,
        producingCountry: 'China',
        color: 'silver',
        warranty: 12,
        diagonal: 14,
        processorManufacturer: 'AMD',
        RAMCapacity: 8,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: false,
        SSDVolume: 128,
        preinstalledOS: null,
        keyboardBacklit: false,
        weight: 1.4,
        id: '499514'
    },
    {
        title: 'Ноутбук HP 250 G8 (5B6X9ES)',
        manufacturer: 'HP',
        discount: 13,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 4,
        available: true,
        price: 49299,
        reviews: 8,
        producingCountry: 'China',
        color: 'black',
        warranty: 12,
        diagonal: 17.3,
        processorManufacturer: 'AMD',
        RAMCapacity: 16,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'AMD Radeon RX 640',
        SSDVolume: 512,
        preinstalledOS: 'Windows 11 Pro',
        keyboardBacklit: false,
        weight: 1.7,
        id: '499515'
    },
    {
        title: 'Ноутбук LENOVO IdeaPad Gaming 3i 15IMH05 (81Y4016LRA)',
        manufacturer: 'LENOVO',
        discount: 12,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 4,
        available: true,
        price: 23966,
        reviews: 7,
        producingCountry: 'China',
        color: 'black',
        warranty: 12,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 16,
        videoCardIntegrated: 'Intel Iris Xe Graphics',
        videoCardDiscrete: 'NVIDIA GeForce RTX 3080',
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 1.4,
        id: '499516'
    },
    {
        title: 'Ноутбук LENOVO IdeaPad 3i 15IML05 (81WB00XERA)',
        manufacturer: 'LENOVO',
        discount: 14,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 2,
        available: true,
        price: 27966,
        reviews: 1,
        producingCountry: 'China',
        color: 'black',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: 'NVIDIA Quadro T1000',
        SSDVolume: 256,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 1.7,
        id: '499517'
    },
    {
        title: 'Ноутбук HP Pavilion x360 (3Y0D1EA)',
        manufacturer: 'HP',
        discount: 17,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: true,
        price: 18566,
        reviews: null,
        producingCountry: 'China',
        color: 'white',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: 'NVIDIA Quadro T1000',
        SSDVolume: 256,
        preinstalledOS: 'DOS',
        keyboardBacklit: true,
        weight: 1.5,
        id: '499518'
    },
    {
        title: 'Ноутбук HP 15-dw3030ua (5B1Y5EA)',
        manufacturer: 'HP',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 4,
        available: false,
        price: 14866,
        reviews: 10,
        producingCountry: 'China',
        color: 'white',
        warranty: 36,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel Iris Xe Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: false,
        weight: 1.5,
        id: '499519'
    },
    {
        title: 'Ноутбук HP Victus 16-e0037ua (5B1Z1EA)',
        manufacturer: 'HP',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: true,
        price: 24999,
        reviews: 4,
        producingCountry: 'China',
        color: 'grey',
        warranty: 36,
        diagonal: 14,
        processorManufacturer: 'Intel',
        RAMCapacity: 16,
        videoCardIntegrated: 'Intel Iris Xe Graphics',
        videoCardDiscrete: 'NVIDIA GeForce MX130',
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 2.2,
        id: '499520'
    },
    {
        title: 'Ноутбук ASUS X515MA-EJ435 (90NB0TH1-M09420)',
        manufacturer: 'ASUS',
        discount: 9,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: false,
        price: 43266,
        reviews: null,
        producingCountry: 'China',
        color: 'white',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel Iris Xe Graphics',
        videoCardDiscrete: 'NVIDIA GeForce MX130',
        SSDVolume: 512,
        preinstalledOS: 'Windows 11 Pro',
        keyboardBacklit: true,
        weight: 2.2,
        id: '499521'
    },
    {
        title: 'Ноутбук ACER Aspire 5 A515-45G (NX.A8BEU.00F)',
        manufacturer: 'ACER',
        discount: 14,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: false,
        price: 76199,
        reviews: null,
        producingCountry: 'China',
        color: 'grey',
        warranty: 36,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650 Ti',
        SSDVolume: 256,
        preinstalledOS: 'Windows 10 Home',
        keyboardBacklit: true,
        weight: 1.8,
        id: '499522'
    },
    {
        title: 'Ноутбук ACER Swift 3 SF314-511 (NX.ABLEU.013)',
        manufacturer: 'ACER',
        discount: 17,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 3,
        available: true,
        price: 19500,
        reviews: 176,
        producingCountry: 'China',
        color: 'grey',
        warranty: 24,
        diagonal: 15.6,
        processorManufacturer: 'Intel',
        RAMCapacity: 16,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 1.9,
        id: '499523'
    },
    {
        title: 'Ноутбук ACER Aspire 7 A715-42G (NH.QDLEU.004)',
        manufacturer: 'ACER',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 2,
        available: true,
        price: 52399,
        reviews: 21,
        producingCountry: 'China',
        color: 'grey',
        warranty: 12,
        diagonal: 14,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650 Ti',
        SSDVolume: 256,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 2.5,
        id: '499524'
    },
    {
        title: 'Ноутбук HP Pavilion x360 14-dy0032ua (48V86EA)',
        manufacturer: 'HP',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: true,
        price: 74966,
        reviews: null,
        producingCountry: 'China',
        color: 'white',
        warranty: 24,
        diagonal: 12.4,
        processorManufacturer: 'AMD',
        RAMCapacity: 8,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'AMD Radeon RX 640',
        SSDVolume: 512,
        preinstalledOS: 'DOS',
        keyboardBacklit: true,
        weight: 1.1,
        id: '499525'
    },
    {
        title: 'Ноутбук HP 245 G8 (2R9G5EA)',
        manufacturer: 'HP',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: false,
        price: 84966,
        reviews: 44,
        producingCountry: 'China',
        color: 'white',
        warranty: 12,
        diagonal: 12.4,
        processorManufacturer: 'AMD',
        RAMCapacity: 32,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650',
        SSDVolume: 256,
        preinstalledOS: 'DOS',
        keyboardBacklit: true,
        weight: 1.2,
        id: '499526'
    },
    {
        title: 'Ноутбук HP OMEN 17-ck0000ua (48V97EA)',
        manufacturer: 'HP',
        discount: 14,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 4,
        available: true,
        price: 44366,
        reviews: 2,
        producingCountry: 'China',
        color: 'white',
        warranty: 12,
        diagonal: 11.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 32,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650',
        SSDVolume: 512,
        preinstalledOS: 'DOS',
        keyboardBacklit: true,
        weight: 1.7,
        id: '499527'
    },
    {
        title: 'Ноутбук HP OMEN 17-ck0001ua (48V98EA)',
        manufacturer: 'HP',
        discount: 10,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: true,
        price: 94166,
        reviews: null,
        producingCountry: 'China',
        color: 'grey',
        warranty: 24,
        diagonal: 11.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 8,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: 'Linux',
        keyboardBacklit: true,
        weight: 1.7,
        id: '499528'
    },
    {
        title: 'Ноутбук ACER Porsche Design ACER Book RS AP714-51GT (NX.A2REU.002)',
        manufacturer: 'ACER',
        discount: 7,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 2,
        available: true,
        price: 13999,
        reviews: 1,
        producingCountry: 'China',
        color: 'grey',
        warranty: 12,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650 Ti',
        SSDVolume: 512,
        preinstalledOS: 'Windows 10 Home',
        keyboardBacklit: true,
        weight: 2.6,
        id: '499529'
    },
    {
        title: 'Ноутбук ACER Swift 1 SF114-34 (NX.A77EU.00J)',
        manufacturer: 'ACER',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 2,
        available: false,
        price: 14799,
        reviews: 1,
        producingCountry: 'China',
        color: 'grey',
        warranty: 12,
        diagonal: 17.3,
        processorManufacturer: 'Intel',
        RAMCapacity: 32,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 256,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 2.6,
        id: '499530'
    },
    {
        title: 'Ноутбук ASUS Vivobook S S433EQ-AM251 (90NB0RK4-M03920)',
        manufacturer: 'ASUS',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: false,
        price: 44499,
        reviews: 3,
        producingCountry: 'China',
        color: 'white',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'Intel',
        RAMCapacity: 32,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 256,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 1.7,
        id: '499531'
    },
    {
        title: 'Ноутбук MSI Raider GE66-11UH (GE6611UH-478UA)',
        manufacturer: 'MSI',
        discount: 17,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: true,
        price: 64999,
        reviews: null,
        producingCountry: 'China',
        color: 'white',
        warranty: 24,
        diagonal: 16,
        processorManufacturer: 'Intel',
        RAMCapacity: 8,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: 'Linux',
        keyboardBacklit: true,
        weight: 1.7,
        id: '499532'
    },
    {
        title: 'Ноутбук MSI Stealth GS66-11UG (GS6611UG-294UA)',
        manufacturer: 'MSI',
        discount: 21,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 3,
        available: true,
        price: 63999,
        reviews: 8,
        producingCountry: 'China',
        color: 'grey',
        warranty: 24,
        diagonal: 16,
        processorManufacturer: 'Intel',
        RAMCapacity: 64,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650 Ti',
        SSDVolume: 512,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 1.8,
        id: '499533'
    },
    {
        title: 'Ноутбук ASUS ROG Zephyrus G14 GA401QE-HZ092 (90NR05R3-M01340)',
        manufacturer: 'ASUS',
        discount: 14,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 5,
        available: true,
        price: 72200,
        reviews: 7,
        producingCountry: 'China',
        color: 'black',
        warranty: 24,
        diagonal: 11.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 8,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: 'Windows 10 Home',
        keyboardBacklit: true,
        weight: 1.8,
        id: '499534'
    },
    {
        title: 'Ноутбук ACER Nitro 5 AN515-55 (NH.QB1EU.006)',
        manufacturer: 'ACER',
        discount: false,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 3,
        available: true,
        price: 9999,
        reviews: 1,
        producingCountry: 'China',
        color: 'black',
        warranty: 12,
        diagonal: 11.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 8,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: 'NVIDIA GeForce GTX 1650',
        SSDVolume: 256,
        preinstalledOS: null,
        keyboardBacklit: true,
        weight: 2.7,
        id: '499535'
    },
    {
        title: 'Ноутбук ACER Nitro 5 AN515-45 (NH.QBSEU.00B)',
        manufacturer: 'ACER',
        discount: 3,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: 2,
        available: true,
        price: 15600,
        reviews: 1,
        producingCountry: 'China',
        color: 'silver',
        warranty: 12,
        diagonal: 16,
        processorManufacturer: 'Intel',
        RAMCapacity: 64,
        videoCardIntegrated: 'Intel UHD Graphics',
        videoCardDiscrete: false,
        SSDVolume: 128,
        preinstalledOS: null,
        keyboardBacklit: false,
        weight: 1.7,
        id: '499536'
    },
    {
        title: 'Ноутбук HP OMEN 15-ek1001ua (422L7EA)',
        manufacturer: 'HP',
        discount: 11,
        markers: {
            hit: false,
            bestPrice: false,
            exclusive: false
        },
        rating: null,
        available: false,
        price: 18200,
        reviews: null,
        producingCountry: 'China',
        color: 'silver',
        warranty: 12,
        diagonal: 15.6,
        processorManufacturer: 'AMD',
        RAMCapacity: 64,
        videoCardIntegrated: 'AMD Radeon Graphics',
        videoCardDiscrete: false,
        SSDVolume: 512,
        preinstalledOS: 'Linux',
        keyboardBacklit: true,
        weight: 1.7,
        id: '499537'
    }
];

var templates = {
    'app': $('#app-template').html(),
    'header': $('#header-template').html(),
    'catalog': $('#catalog-template').html(),
    'catalog.filter': $('#catalog-filter-template').html(),
    'catalog.content.head': $('#catalog-content-head-template').html(),
    'catalog.products': $('#catalog-products-template').html(),
    'catalog.product.grid': $('#catalog-product-grid-template').html(),
    'catalog.product.list': $('#catalog-product-list-template').html(),
    'catalog.load': $('#catalog-load-template').html(),
    'compare': $('#compare-template').html(),
    'popup': $('#popup-template').html(),
    'cart': $('#cart-template').html()
};

var formatPrice = function(price) {
    return price.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1 ');
};

var translationsRU = {
    'global.yes': 'Да',
    'global.no': 'Нет',
    'catalog.header.title': 'Ноутбуки',
    'app.header.lang.ru': 'Рус',
    'app.header.lang.ua': 'Укр',
    'catalog.product.price': 'Цена',
    'catalog.product.productId': 'Код товара',
    'catalog.product.currency': 'грн',
    'catalog.product.cashback': 'кэшбек',
    'catalog.product.notAvailable': 'Нет в наличии',
    'catalog.product.reviews': 'отзывов',
    'catalog.product.markers.exclusive': 'Эксклюзив',
    'catalog.product.markers.bestPrice': 'Лучшая цена',
    'catalog.product.markers.hit': 'Хит',
    'catalog.product.btn.buy': 'Купить',
    'catalog.product.btn.notify': 'Уведомить',
    'catalog.product.processor': 'Процессор (модель)',
    'catalog.product.diagonal': 'Дисплей (диагональ)',
    'catalog.product.RAMCapacity': 'Оперативная память (объем), Гб',
    'catalog.product.preinstalledOS': 'Предустановленная ОС',
    'catalog.product.notPreinstalledOS': 'Без ОС',
    'catalog.product.videoCardDiscrete': 'Видеокарта (дискретная)',
    'catalog.product.videoCardIntegrated': 'Видеокарта (интегрированная)',
    'catalog.product.keyboardBacklit': 'Клавиатура (подсветка)',
    'catalog.product.warranty': 'Гарантия, мес.',
    'catalog.product.keyboardBacklit.yes': 'Есть',
    'catalog.product.keyboardBacklit.no': 'Нет',
    'catalog.product.favorites': 'В список желаний',
    'catalog.product.compare': 'В сравнение',
    'catalog.head.showFirst': 'Показать сначала',
    'catalog.head.ascending_price': 'дешевые',
    'catalog.head.descending_price': 'дорогие',
    'catalog.head.dropdown.all': 'Все характеристики',
    'catalog.head.dropdown.different': 'Только отличия',
    'catalog.head.dropdown.equal': 'Только совпадения',
    'catalog.head.title': 'Сранение',
    'catalog.product.SSDVolume': 'Объём SSD',
    'compare.product.props.color': 'Цвет',
    'compare.product.props.color.silver': 'Серебристый',
    'compare.product.props.color.grey': 'Серый',
    'compare.product.props.color.black': 'Чёрный',
    'compare.product.props.color.white': 'Белый',
    'compare.product.props.producingCountry': 'Страна изготовитель',
    'compare.product.props.producingCountry.China': 'Китай',
    'compare.product.props.manufacturer': 'Изготовитель',
    'compare.product.props.SSDVolume': 'Объём SSD',
    'compare.product.props.weight': 'Вес ноутбука (без ЗП), кг',
    'compare.product.props.processorManufacturer': 'Процессор (модель)',
    'compare.product.props.diagonal': 'Дисплей (диагональ)',
    'compare.product.props.RAMCapacity': 'Оперативная память (объем), Гб',
    'compare.product.props.preinstalledOS': 'Предустановленная ОС',
    'compare.product.props.notPreinstalledOS': 'Без ОС',
    'compare.product.props.videoCardDiscrete': 'Видеокарта (дискретная)',
    'compare.product.props.videoCardDiscrete.false': 'Нет',
    'compare.product.props.videoCardIntegrated': 'Видеокарта (интегрированная)',
    'compare.product.props.keyboardBacklit': 'Клавиатура (подсветка)',
    'compare.product.props.keyboardBacklit.true': 'Есть',
    'compare.product.props.keyboardBacklit.false': 'Нет',
    'compare.product.props.warranty': 'Гарантия, мес.',
    'cart.product.currency': 'грн',
    'cart.product.cashback': 'кэшбек',
    'cart.header.title': 'Корзина',
    'cart.header.count': 'товаров',
    'cart.footer.sum': 'Сумма заказа'
};

var translationsUA = {
    'global.yes': 'Так',
    'global.no': 'Ні',
    'catalog.header.title': 'Ноутбуки',
    'app.header.lang.ru': 'Рус',
    'app.header.lang.ua': 'Укр',
    'catalog.product.price': 'Ціна',
    'catalog.product.productId': 'Код товару',
    'catalog.product.currency': 'грн',
    'catalog.product.cashback': 'кешбек',
    'catalog.product.notAvailable': 'Немає в наявності',
    'catalog.product.reviews': 'відгуків',
    'catalog.product.markers.exclusive': 'Ексклюзив',
    'catalog.product.markers.bestPrice': 'Найкраща ціна',
    'catalog.product.markers.hit': 'Хіт',
    'catalog.product.btn.buy': 'Купити',
    'catalog.product.btn.notify': 'Повідомити',
    'catalog.product.processor': 'Процесор (модель)',
    'catalog.product.diagonal': 'Дисплей (діагональ)',
    'catalog.product.RAMCapacity': 'Оперативна пам\'ять (обсяг), Гб',
    'catalog.product.preinstalledOS': 'Попередньо встановлена ОС',
    'catalog.product.notPreinstalledOS': 'Без ОС',
    'catalog.product.videoCardDiscrete': 'Відеокарта (дискретна)',
    'compare.product.props.videoCardDiscrete.false': 'Ні',
    'catalog.product.videoCardIntegrated': 'Відеокарта (інтегрована)',
    'catalog.product.keyboardBacklit': 'Клавіатура (підсвічування)',
    'catalog.product.warranty': 'Гарантія, міс.',
    'catalog.product.keyboardBacklit.yes': 'Є',
    'catalog.product.keyboardBacklit.no': 'Ні',
    'catalog.product.favorites': 'До списку бажань',
    'catalog.product.compare': 'В порівнянні',
    'catalog.head.showFirst': 'Показати одразу',
    'catalog.head.ascending_price': 'дешеві',
    'catalog.head.descending_price': 'дорогі',
    'catalog.head.dropdown.all': 'Усі характеристики',
    'catalog.head.dropdown.different': 'Тільки відмінності',
    'catalog.head.dropdown.equal': 'Тільки збіги',
    'catalog.head.title': 'Порівняння',
    'catalog.product.SSDVolume': 'Об\'єм SSD',
    'compare.product.props.color': 'Колір',
    'compare.product.props.color.silver': 'Сріблястий',
    'compare.product.props.color.black': 'Чорний',
    'compare.product.props.color.grey': 'Сірий',
    'compare.product.props.color.white': 'Білий',
    'compare.product.props.producingCountry': 'Країна виробник',
    'compare.product.props.producingCountry.China': 'Китай',
    'compare.product.props.manufacturer': 'Виробник',
    'compare.product.props.SSDVolume': 'Об\'єм SSD',
    'compare.product.props.weight': 'Вага ноутбука (без ЗП), кг',
    'compare.product.props.processor': 'Процесор (модель)',
    'compare.product.props.diagonal': 'Дисплей (діагональ)',
    'compare.product.props.RAMCapacity': 'Оперативна пам\'ять (обсяг), Гб',
    'compare.product.props.preinstalledOS': 'Попередньо встановлена ОС',
    'compare.product.props.notPreinstalledOS': 'Без ОС',
    'compare.product.props.videoCardDiscrete': 'Відеокарта (дискретна)',
    'compare.product.props.videoCardIntegrated': 'Відеокарта (інтегрована)',
    'compare.product.props.keyboardBacklit': 'Клавіатура (підсвічування)',
    'compare.product.props.keyboardBacklit.true': 'Є',
    'compare.product.props.keyboardBacklit.false': 'Ні',
    'compare.product.props.warranty': 'Гарантія, міс.',
    'cart.product.currency': 'грн',
    'cart.product.cashback': 'кешбек',
    'cart.header.title': 'Кошик',
    'cart.header.count': 'товарів',
    'cart.footer.sum': 'Сума замовлення'
};

var i18n = {
    t: function(tk) {
        var lang = appModel.get('lang');

        if (lang === 'ru') {
            return translationsRU[tk];
        } else {
            return translationsUA[tk];
        }
    }
};

var appModel = new Backbone.Model({
    lang: 'ru',         // ru ua
    page: 'catalog'     // catalog compare
});

var catalogModel = new Backbone.Model({
    viewType: 'grid',           // grid list
    sortBy: 'default'           // default ascending_price descending_price...
});

var compareModel = new Backbone.Model({
    items: [],          // product IDs
    propsFilter: 'all'     // all different equal
});

var cartModel = new Backbone.Model({
    items: []           // {id: '', qty: 4}
});

var Products = Backbone.Collection.extend({
    toJSON() {
        var getPriceWithDiscount = function(price, discount = 0) {
            return Math.ceil(price - price * discount / 100);
        };

        var getCashback = function(price, rate = 0) {
            return Math.ceil(price * rate);
        };

        var models = Backbone.Collection.prototype.toJSON.apply(this);
        models.forEach(function(model) {
            model.priceWithDiscount = getPriceWithDiscount(model.price, model.discount);
            model.cashback = getCashback(model.price, 0.01);
        });
        return models;
    }
});

var products = new Products(_products);

var BaseView = Backbone.View.extend({
    tmpl(templateName, templateData) {
        return doT.template(templates[templateName])(templateData);
    }
});

var AppView = BaseView.extend({
    initialize: function() {
        $('body').append(this.render().el);
        this.listenTo(appModel, 'change:lang', this.render);
        this.listenTo(appModel, 'change:page', this.render);
        this.listenTo(compareModel, 'change:items', this.render);
        this.listenTo(cartModel, 'change:items', this.render);
    },

    className: 'app',

    events: {
        'click .header-lang [data-lng]': 'onLangClick',
        'click .item--compare': 'onCompareClick',
        'click .item--cart': 'onCartClick'
    },

    onCompareClick() {
        appModel.set('page', 'compare');
    },

    onCartClick() {
        new PopupView({
            content: new CartView().render().$el
        }).render().$el.appendTo('body');
    },

    onLangClick(e) {
        var langAcronym = e.currentTarget.dataset.lng;
        appModel.set('lang', langAcronym);
    },

    render() {
        this.$el.html(this.tmpl('app'));

        this.renderHeader();
        this.renderPageContent();

        return this;
    },

    renderHeader() {
        var lang = appModel.get('lang');
        var compareItems = compareModel.get('items');
        var cartItems = cartModel.get('items');
        var totalCartItemsCount = cartItems.reduce(function(sum, product) {
            return sum + product.qty;
        }, 0);

        this.$('.header-container').html(this.tmpl('header', {
            lang: lang,
            compareItemsCount: compareItems.length,
            totalCartItemsCount: totalCartItemsCount
        }));
    },

    renderPageContent() {
        var page = appModel.get('page');

        if (page === 'catalog') {
            this.$('.page-content-container').html(new CatalogView().render().el);
        } else {
            this.$('.page-content-container').html(new CompareView().render().el);
        }
    }
});

var CatalogView = BaseView.extend({
    initialize() {
        this.listenTo(catalogModel, 'change:viewType', this.render);
        this.listenTo(catalogModel, 'change:sortBy', this.render);
    },

    className: 'catalog',

    events: {
        'click .catalog_products-view_item': 'onViewTypeClick',
        'click .catalog_content_sort_item': 'onSortByClick',
        'click .product-item_compare-btn': 'onCompareClick',
        'click .buy-btn': 'onBuyClick'
    },

    onViewTypeClick(e) {
        var viewType = e.currentTarget.dataset.layout;
        catalogModel.set('viewType', viewType);
    },

    onSortByClick(e) {
        var sortBy = e.currentTarget.dataset.sort;
        catalogModel.set('sortBy', sortBy);
    },

    onCompareClick(e) {
        var productId = e.currentTarget.dataset.productId;
        var compareItems = compareModel.get('items');
        var newCompareItems = compareItems.includes(productId) ?
            compareItems.filter(function(el) {
                return el !== productId;
            }) :
            [...compareItems, productId];

        compareModel.set('items', newCompareItems);
    },

    onBuyClick(e) {
        var productId = e.target.dataset.productId;
        var cartItems = cartModel.get('items');

        var newCartItems = cartItems.find((item) => item.id === productId) ?
            cartItems.map((item) => {
                if(item.id === productId) {
                    return {
                        ...item,
                        qty: item.qty + 1
                    };
                } else {
                    return item;
                }
            })
             :
            [
                ...cartItems,
                {
                    id: productId,
                    qty: 1
                }
            ];

        cartModel.set('items', newCartItems);

        new PopupView({
            content: new CartView().render().$el
        }).render().$el.appendTo('body');
    },

    render() {
        this.$el.html(this.tmpl('catalog', {
            productsCount: products.length
        }));

        this.renderFilter();
        this.renderContentHead();
        this.renderProducts();
        this.renderLoad();

        return this;
    },

    renderFilter() {
        this.$('.catalog-filter-container').html(this.tmpl('catalog.filter'));
    },

    renderContentHead() {
        var viewType = catalogModel.get('viewType');
        var sortBy = catalogModel.get('sortBy');

        this.$('.catalog-content-head-container').html(this.tmpl('catalog.content.head', {
            viewType: viewType,
            sortBy: sortBy
        }));
    },

    getItemsSortedBy: function(models, sortBy) {
        if (sortBy === 'default') {
            return models;
        } else {
            var [direction, field] = sortBy.split('_');
            // direction: ascending descending
            // field: title rating year time

            if (field === 'price') {
                field = 'priceWithDiscount';
            }

            return direction === 'ascending' ?
                _.sortBy(models, field) :
                _.sortBy(models, field).reverse();
        }
    },

    renderProducts() {
        var compareItems = compareModel.get('items');
        var viewType = catalogModel.get('viewType');
        var sortBy = catalogModel.get('sortBy');
        var _products = products.toJSON();
        _products = this.getItemsSortedBy(_products, sortBy);

        this.$('.catalog-products-container').html(this.tmpl('catalog.products', {
            viewType: viewType
        }));

        this.$('.catalog-products').html(this.tmpl(`catalog.product.${viewType}`, {
            products: _products,
            compareItems: compareItems
        }));
    },

    renderLoad() {
        this.$('.catalog-load-container').html(this.tmpl('catalog.load'));
    }
});

var CompareView = BaseView.extend({
    initialize() {
        this.listenTo(compareModel, 'change:items', this.render);
        this.listenTo(compareModel, 'change:propsFilter', this.render);
        window.addEventListener('scroll', this.onScroll.bind(this));
    },

    className: 'compare',

    events: {
        'click .product-card_remove': 'onRemoveClick',
        'change .category-filter': 'onPropsFilterChange'
    },

    onPropsFilterChange(e) {
        var propsFilter = e.currentTarget.value;

        compareModel.set('propsFilter', propsFilter);
    },

    onRemoveClick(e) {
        var productId = e.target.dataset.id;
        var compareItemsIds = compareModel.get('items');
        var newCompareItemsIds;

        newCompareItemsIds = compareItemsIds.filter(function(el) {
            return el !== productId;
        });

        compareModel.set('items', newCompareItemsIds);
    },

    getProductsByIds: function(ids = []) {
        var _products = products.toJSON();

        return _products.filter((i) => ids.includes(i.id));
    },

    isPropEqual(products, prop) {
        return products.every((product) => product[prop] === products[0][prop]);
    },

    onScroll() {
        this.$('.compare-table-header').toggleClass('compare-table-header--compact', window.scrollY > 300);
    },

    render() {
        var compareItemsIds = compareModel.get('items');
        var propsFilter = compareModel.get('propsFilter');

        this.$el.html(this.tmpl('compare', {
            products: this.getProductsByIds(compareItemsIds),
            isPropEqual: this.isPropEqual,
            propsFilter: propsFilter
        }));

        return this;
    }
});

var PopupView = BaseView.extend({
    options: {
        content: ''
    },

    initialize(options) {
        this.options = _.extend(this.options, options);
    },

    events: {
        'click .modal__close': 'onClosePopupClick'
    },

    onClosePopupClick() {
        this.remove();
    },

    render() {
        this.$el.html(this.tmpl('popup'));
        this.$('.modal__content').html(this.options.content);

        return this;
    }
});

var CartView = BaseView.extend({
    initialize() {
        this.listenTo(cartModel, 'change:items', this.render);
    },

    events: {
        'click .qty-btn.plus': 'onPlusClick',
        'click .qty-btn.minus': 'onMinusClick',
        'click .cart-item__remove': 'onRemoveClick'
    },

    onRemoveClick(e) {
        var productId = e.currentTarget.dataset.product_id;
        var cartItems = cartModel.get('items');

        var newCartItems = cartItems.filter(function(item) {
            return item.id !== productId;
        });

        cartModel.set('items', newCartItems);
    },

    onPlusClick(e) {
        var productId = e.currentTarget.dataset.product_id;
        var cartItems = cartModel.get('items');

        var newCartItems = cartItems.map(function(item) {
            if (item.id === productId) {
                return {
                    id: item.id,
                    qty: item.qty + 1
                };
            } else {
                return item;
            }
        });

        cartModel.set('items', newCartItems);
    },

    onMinusClick(e) {
        var productId = e.currentTarget.dataset.product_id;
        var cartItems = cartModel.get('items');

        var newCartItems = cartItems.map(function(item) {
            if (item.id === productId) {
                return {
                    id: item.id,
                    qty: item.qty - 1
                };
            } else {
                return item;
            }
        });

        cartModel.set('items', newCartItems);
    },

    getTemplateData() {
        var cartItems = cartModel.get('items');
        var _products = products.toJSON();
        var __products = cartItems.map((cartItem) => {
            let product = _.findWhere(_products, {id: cartItem.id});

            return {
                ...product,
                ...cartItem,
                priceWithQty: product.priceWithDiscount*cartItem.qty,
                cashbackWithQty: product.cashback*cartItem.qty
            };
        });

        var _totalAmount = __products.reduce(function(sum, product) {
            return sum + product.priceWithQty;
        }, 0);

        var _totalProductsCount = cartItems.reduce(function(sum, product) {
            return sum + product.qty;
        }, 0);

        var _totalCashback = __products.reduce(function(sum, product) {
            return sum + product.cashbackWithQty;
        }, 0);

        return {
            totalProductsCount: _totalProductsCount,
            products: __products,
            totalAmount: formatPrice(_totalAmount),
            totalCashback: _totalCashback
        };
    },

    render() {
        this.$el.html(this.tmpl('cart', this.getTemplateData()));

        return this;
    }
});

var appView = new AppView;




























/* ------------------------------------------------------------------------------------ */

//base view, info